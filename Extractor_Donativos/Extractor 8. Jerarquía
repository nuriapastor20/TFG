set vListFILIAL = '9003','9186','16729','16802','16941','17500','9500';
set vListCIB = '9464';

MAP_CENTRO_DESCRIPCION:
MAPPING LOAD 
distinct
PK_CENTRO,
DES_CENTRO;
SQL SELECT PK_CENTRO, DES_CENTRO FROM CENTROS1;

Jerarquia:
LOAD *,
if(FK_TIPO_CENTRO = 'OF', applymap('MAP_CENTRO_DESCRIPCION',("CENTRO_INTEGRADO"),"DES_CENTRO") &' - '& CENTRO_INTEGRADO,'Desconocido') as Oficina
;
LOAD "PK_CENTRO", FK_TIPO_CENTRO_GES, "DES_CENTRO_GES", DES_CENTRO, if(FK_TIPO_DAN = 'GC',"COD_DAN",'Desconocido') as "COD_DAN",
    if(FK_TIPO_DAN = 'GC',"DES_DAN",'Desconocido') as "DES_DAN", if(FK_TIPO_DAN = 'GC',"DES_DAN" & ' - ' & "COD_DAN",'Desconocido') as [DAN],
    FK_TIPO_CENTRO, FK_SUBTIPO_CENTRO, "FK_TIPO_DAN", "FK_SITU_DAN", if(FK_TIPO_DT = 'DT',"COD_DT",'Desconocido') as "COD_DT", 
    if(FK_TIPO_DT = 'DT',"DES_DT",'Desconocido') as "DES_DT", if(FK_TIPO_DT = 'DT',"DES_DT" & ' - ' & "COD_DT",'Desconocido') as [DT],
    IF(WildMatch("DES_DT",'TERRITORIAL*'), 'Red' , 'SSCC') AS √Åmbito, If(match(COD_DT, $(vListFILIAL)) or PK_CENTRO='33333' , 'FILIALES Y SSCC',
    IF(WildMatch("DES_DT",'TERRITORIAL*'), DES_DT, If(match(COD_DT, $(vListCIB)) , 'CIB', 'OTROS'))) as Territoriales, "COD_RED", "DES_RED",
    "COORDENADA_X", "COORDENADA_Y"
;
SQL SELECT "CENTROS_JER"."PK_CENTRO", "CENTROS_JER"."DES_CENTRO_GES", "CENTROS_JER"."FK_TIPO_CENTRO_GES", "CENTROS_JER"."FK_SITU_CENTRO_GES", 
	"CENTROS_JER"."IND_FICTICIO_CENTRO_GES", "CENTROS_JER"."COD_CENTRO2", "CENTROS_JER"."DES_CENTRO2", "CENTROS_JER"."FK_TIPO_CENTRO2", 
    "CENTROS_JER"."FK_SITU_CENTRO2", "CENTROS_JER"."IND_FICTICIO_CENTRO2", "CENTROS_JER"."COD_DAN", "CENTROS_JER"."DES_DAN",
    "CENTROS_JER"."FK_TIPO_DAN", "CENTROS_JER"."FK_SITU_DAN", "CENTROS_JER"."IND_FICTICIO_DAN", "CENTROS_JER"."FK_TIPO_DG", 
    "CENTROS_JER"."FK_SITU_DG", "CENTROS_JER"."IND_FICTICIO_DG", "CENTROS_JER"."COD_DT", "CENTROS_JER"."DES_DT", "CENTROS_JER"."COD_RED", 
    "CENTROS_JER"."DES_RED", "CENTROS2"."COORDENADA_X", "CENTROS2"."COORDENADA_Y", "CENTROS2"."DES_CENTRO", "CENTROS2"."FK_TIPO_CENTRO", 
    "CENTROS2"."FK_SUBTIPO_CENTRO"

FROM "CENTROS_JER" INNER JOIN "ELE_CTM"."CENTROS2"
ON "CENTROS_JER"."PK_EMPRESA" = "CENTROS2"."PK_EMPRESA" AND "CENTROS_JER"."PK_CENTRO" = "CENTROS2"."PK_CENTRO"
WHERE "CENTROS_JER"."PK_EMPRESA" = 1;
store 'Jerarquia' into 'Extractor/Jerarquia.qvd' (qvd);      

PROVINCIAS:
LOAD "PK_PROVINCIA", "DES_PROVINCIA", "FK_AUTONOMIA" as PK_AUTONOMIA;
SQL SELECT "PK_PROVINCIA", "DES_PROVINCIA", "FK_AUTONOMIA" 
FROM "PROVINCIAS";
store 'PROVINCIAS' into 'Extractor/PROVINCIAS.qvd' (qvd);      

AUTONOMIAS:
LOAD "PK_AUTONOMIA", "DES_AUTONOMIA";
SQL SELECT "PK_AUTONOMIA", "DES_AUTONOMIA"
FROM "AUTONOMIAS";
store 'AUTONOMIAS' into 'Extractor/AUTONOMIAS.qvd' (qvd);      


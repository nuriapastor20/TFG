DONACIONES:
Load *, if(isnull(PK_NUM_ONG_1),ApplyMap('Map_NIF_ONG',NIF,-1),PK_NUM_ONG_1) as PK_NUM_ONG; 
LOAD "PK_NUM_DON", ApplyMap('MAP_NUMPER_NIF',("FK_NUMPERSO_DES"),null()) AS NIF, "FK_NUMPERSO_DES" as PK_NUMPERSO, "FK_COD_CAUSA" as PK_COD_CAUSA, 
    "COD_CANAL" as PK_CANAL, "COD_ORIGEN", IMPORTE, ApplyMap('MAP_INTEGRADOS',("OFICINA_DON"),"OFICINA_DON") as PK_CENTRO, "OFICINA_DON" as PK_CENTRO_OLD, "COD_PROVINCIA" as PK_PROVINCIA, 
    AutoNumber(If(IsNull(COD_NEGOCIO) or COD_NEGOCIO=-1, 'PAR', COD_NEGOCIO), 'negocios') as PK_NEGOCIO, "COD_COMERCIO", date(FECHA_DONATIVO,'DD-MM-YYYY') as  FECHA_DONATIVO, 
    "FECHA_DATOS" as FECHA_DATOS_DONACIONES, 'Aceptado' as IND_ESTADO_DONATIVO, 'P' as "FRECUENCIA_DON", 'D' as "TIPO_DON", ApplyMap('Map_Numperso_ONG',FK_NUMPERSO_DES,-1) as PK_NUM_ONG_1
WHERE num(date(FECHA_DONATIVO,'DD-MM-YYYY')) >= $(fechaInicialCargaDonativos)
;
SQL SELECT "PK_NUM_DON", "FK_NUMPERSO_DES", "FK_COD_CAUSA", "FK_NUM_ONG", "COD_CANAL", "COD_ORIGEN", IMPORTE, "OFICINA_DON", "COD_PROVINCIA", "COD_NEGOCIO",
    "COD_COMERCIO", "FECHA_DONATIVO", "FECHA_CARGA", "FECHA_DATOS"
FROM "DONACIONES" WHERE NOT COD_ORIGEN LIKE 'TRF';

Concatenate
DONACIONES_ONG:
LOAD FK_NUM_PER_ONG as PK_NUMPERSO, NIF_ONG as NIF_original, "FK_NUM_PER" as  PK_NUMPERSO_PERS_DONANTE, "IND_CLIENTE", COD_NUM_DONANTE_UNICO, "FK_COD_CAUSA" as PK_COD_CAUSA,
	"FK_NUM_ONG" as PK_NUM_ONG, "COD_CANAL" as PK_CANAL, 'ONG' as COD_ORIGEN, "COD_ORIGEN" as COD_ORIGEN_ONG, IMPORTE, "COD_OFICINA_DONATIVO"  as PK_CENTRO_OLD,
    ApplyMap('MAP_INTEGRADOS',("COD_OFICINA_DONATIVO"),"COD_OFICINA_DONATIVO") as PK_CENTRO, "COD_PROVINCIA" as PK_PROVINCIA, "FECHA_CONTENIDO" as FECHA_DATOS_DONACIONES, 
    AutoNumber(If(IsNull(COD_NEGOCIO) or COD_NEGOCIO=-1, 'PAR', COD_NEGOCIO), 'negocios') as PK_NEGOCIO, date(FECHA_DONATIVO,'DD-MM-YYYY') as  FECHA_DONATIVO, 
    "IND_MICRO" as IND_MICRO_ONG, "IND_COM", "IND_TRANS", If(match("IND_ACTIVIDAD",'R'), 'Retrocedido', 'Aceptado') as IND_ESTADO_DONATIVO, "IND_CESION_DATOS", "TIPO_DON", "FRECUENCIA_DON",
    "DIGITO_CONTROL", if(IsNUll("TIPO_PERS"), ApplyMap('MAP_TIPO_PERSONA',("FK_NUM_PER"),null()), "TIPO_PERS") as "TIPO_PERSONA", "ENTIDAD_TRANS", "OFICINA_TRANS", "DIGITO_CONTROL_TRANS", 
    "NUMERO_CONT_TRANS", "OFICINA_RETR", DOCID, DOCIDGAV, ENTEXT, CLAUBIZ, date(FECHA_COMISION,'DD-MM-YYYY') as FECHA_COMISION_ONG, date(FECHA_TRANSACCION,'DD-MM-YYYY')  as FECHA_TRANSACCION_ONG, 
    date(FECHA_RETROCESION,'DD-MM-YYYY')   as FECHA_RETROCESION_ONG, ApplyMap('MAP_NUMPER_NIF',("FK_NUM_PER_ONG"),null()) AS NIF, "PK_NUM_DON"
WHERE num(date(FECHA_DONATIVO,'DD-MM-YYYY')) >= $(fechaInicialCargaDonativos);
SQL SELECT DONACIONES_ONG"."PK_NUM_DON", "DONACIONES_ONG"."FK_NUM_ONG", "DONACIONES_ONG"."FK_NUM_PER", "DONACIONES_ONG"."FK_COD_CAUSA", "DONACIONES_ONG"."COD_NUM_DONANTE_UNICO", 
	"DONACIONES_ONG"."COD_OFICINA_DONATIVO", "DONACIONES_ONG"."COD_CANAL", "DONACIONES_ONG"."COD_ORIGEN", "DONACIONES_ONG"."COD_PROVINCIA", "DONACIONES_ONG"."COD_NEGOCIO", 
    "DONACIONES_ONG"."IND_MICRO", "DONACIONES_ONG"."IND_COM", "DONACIONES_ONG"."IND_TRANS", "DONACIONES_ONG"."IND_ACTIVIDAD","DONACIONES_ONG"."IND_CESION_DATOS", "DONACIONES_ONG"."TIPO_DON", 
    "DONACIONES_ONG"."FRECUENCIA_DON", "DONACIONES_ONG"."DIGITO_CONTROL", "DONACIONES_ONG".IMPORTE, "DONACIONES_ONG"."TIPO_PERS", "DONACIONES_ONG"."ENTIDAD_TRANS", "DONACIONES_ONG"."OFICINA_TRANS", 
    "DONACIONES_ONG"."DIGITO_CONTROL_TRANS", "DONACIONES_ONG"."NUMERO_CONT_TRANS", "DONACIONES_ONG"."OFICINA_RETR", "DONACIONES_ONG".DOCID, "DONACIONES_ONG".DOCIDGAV, "DONACIONES_ONG".ENTEXT, 
    "DONACIONES_ONG".CLAUBIZ, "DONACIONES_ONG"."FECHA_DONATIVO", "DONACIONES_ONG"."FECHA_COMISION", "DONACIONES_ONG"."FECHA_TRANSACCION", "DONACIONES_ONG"."FECHA_RETROCESION", 
    "DONACIONES_ONG"."FECHA_CONTENIDO", "B"."IND_CLIENTE", "ONG"."FK_NUM_PER_ONG", "ONG"."NIF_ONG"
FROM "DONACIONES_ONG"
LEFT JOIN (SELECT PK_NUMPERSO,IND_CLIENTE FROM "CLIENTES") B ON B."PK_NUMPERSO" = "DONACIONES_ONG"."FK_NUM_PER"
LEFT JOIN (SELECT "PK_NUM_ONG", "FK_NUM_PER" AS FK_NUM_PER_ONG, "NIF_ONG" FROM "ONG") ONG ON "ONG"."PK_NUM_ONG" = "DONACIONES_ONG"."FK_NUM_ONG"
WHERE "DONACIONES_ONG"."IND_ACTIVIDAD" IS NULL; 

Concatenate
TX_ASR_DONACIONES_BIZ:
LOAD *
Resident TX_ASR_DONACIONES_BIZ_AUX
WHERE FLAG_DUPLICADOS <> 1;

Left Join IntervalMatch (FECHA_DONATIVO,PK_COD_CAUSA) 
LOAD FECHA_INICIO_CAUSA, FECHA_FIN_CAUSA, PK_COD_CAUSA
Resident TM_ASR_CAUSAS;

store 'DONACIONES' into 'DONACIONES.qvd' (qvd);   

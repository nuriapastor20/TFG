DONACIONES_BIZ_AUX:
Load *,
AutoNumber(If(IsNull(COD_NEGOCIO) or COD_NEGOCIO=-1, 'PAR', COD_NEGOCIO), 'negocios') as PK_NEGOCIO,
ApplyMap('MAP_INTEGRADOS',(PK_CENTRO_OLD),PK_CENTRO_OLD) as PK_CENTRO,
if(isnull(PK_NUM_ONG_1),ApplyMap('Map_NIF_ONG',NIF,-1),PK_NUM_ONG_1) as PK_NUM_ONG,
text(COD_BIZUM)& ' - ' & [NIF] as PK_COD_CAUSA,
; 
Load
PK_NUM_SECUENCIA AS PK_NUM_DON, FK_NUMPERSO AS PK_NUMPERSO, FK_NUMPERSO_DON AS PK_NUMPERSO_PERS_DONANTE,
COD_NUM_DONANTE_UNICO, 
ApplyMap('Map_Numperso_ONG',FK_NUMPERSO,Null()) as PK_NUM_ONG_1, 
IMPORTE,
if(IsNUll("COD_TIPO_PERSONA"), ApplyMap('MAP_TIPO_PERSONA', FK_NUMPERSO_DON, -1), "COD_TIPO_PERSONA") as TIPO_PERSONA, 
NIF as NIF_original, 
ApplyMap('MAP_NUMPER_NIF',("FK_NUMPERSO"),NIF) AS NIF,
If(IsNull(COD_NEGOCIO) or COD_NEGOCIO=-1, COD_NEGOCIO_CLI, COD_NEGOCIO) as COD_NEGOCIO,
if(IsNUll(IND_CLIENTE), IND_CLIENTE_CLI, IND_CLIENTE) as IND_CLIENTE, 
if(IsNull(COD_OFICINA_DON), COD_OFICINA_DON_CLI, COD_OFICINA_DON) as PK_CENTRO_OLD, 
COD_BIZUM, ID_TX AS CLAUBIZ,
ApplyMap('MAP_CLAUBIZ',ID_TX,0) AS FLAG_DUPLICADOS,
'P' as FRECUENCIA_DON, 'D' as TIPO_DON, 'BIZ' as COD_ORIGEN,
"COD_CANAL" as PK_CANAL,
ApplyMap('Map_SubCanal_BIZ',"COD_CANAL_DON",'Otros') as SUBCANAL_BIZ,
'Aceptado' as IND_ESTADO_DONATIVO, 
date(FECHA_DONATIVO,'DD-MM-YYYY') as  FECHA_DONATIVO,
"FECHA_DATOS" as FECHA_DATOS_DONACIONES,
"FECHA_CARGA"
WHERE num(date(FECHA_DONATIVO,'DD-MM-YYYY')) >= $(fechaInicialCargaDonativos)
;
SQL SELECT 
	"DONACIONES_BIZ"."PK_ANYOMES", "DONACIONES_BIZ"."PK_NUM_SECUENCIA", "DONACIONES_BIZ"."IMPORTE",
    "DONACIONES_BIZ"."ID_TX", "DONACIONES_BIZ"."DES_BIZUM", TO_CHAR("DONACIONES_BIZ"."COD_BIZUM") AS COD_BIZUM,
    "DONACIONES_BIZ"."DES_ESTADO", "DONACIONES_BIZ"."COD_SUBESTADO", "DONACIONES_BIZ"."FK_NUMPERSO",
    "DONACIONES_BIZ"."FK_NUMPERSO_DON", "DONACIONES_BIZ"."NIF", "DONACIONES_BIZ"."COD_NUM_DONANTE_UNICO",
    "DONACIONES_BIZ"."IND_CLIENTE", "DONACIONES_BIZ"."COD_NEGOCIO", "DONACIONES_BIZ"."COD_SENYAL",
    "DONACIONES_BIZ"."COD_BANCO", "DONACIONES_BIZ"."COD_BANCO_DON", "DONACIONES_BIZ"."COD_OFICINA_DON",
    "DONACIONES_BIZ"."COD_CANAL", "DONACIONES_BIZ"."COD_CANAL_DON", "DONACIONES_BIZ"."FECHA_CARGA",
    "DONACIONES_BIZ"."FECHA_DATOS", "DONACIONES_BIZ"."FECHA_DONATIVO", B.COD_TIPO_PERSONA, 
    C.FK_CENTRO_GESTOR AS COD_OFICINA_DON_CLI, C.IND_CLIENTE AS IND_CLIENTE_CLI, C.COD_NEGOCIO AS COD_NEGOCIO_CLI    
FROM "DONACIONES_BIZ"
LEFT JOIN (SELECT PK_ANYOMES, PK_NUMPERSO, COD_TIPO_PERSONA FROM PERSONAS_PH
WHERE PK_EMPRESA_GRUPO = 1) B ON "DONACIONES_BIZ"."PK_ANYOMES" = B.PK_ANYOMES AND "DONACIONES_BIZ"."FK_NUMPERSO_DON" = B.PK_NUMPERSO
LEFT JOIN (SELECT PK_NUMPERSO, FK_CENTRO_GESTOR, IND_CLIENTE, COD_NEGOCIO FROM CLIENTES
WHERE PK_EMPRESA_GRUPO = 1) C ON "DONACIONES_BIZ"."FK_NUMPERSO_DON" = C.PK_NUMPERSO;
